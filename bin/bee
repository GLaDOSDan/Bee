#!/usr/bin/env php
<?php

/*

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

Created by GLaDOSDan <gladosdan@gmail.com> - June 2013

http://github.com/GLaDOSDan/Bee

*/

require_once __DIR__ . '/../vendor/autoload.php';

use GLaDOSDan\Bee\Command;
use GLaDOSDan\Bee\Torrent;

define('PEER_ID', '-BEE_DEBUG-');
$GLOBALS['ANNOUNCE_URL_OVERRIDE'] = ''; //Leave blank if you want to use the announce url from the .torrent file

echo "\n";
echo "                 \\     /\n";
echo "             \\    o ^ o    /\n";
echo "               \\ (     ) /\n";
echo "    ____________(%%%%%%%)____________\n";
echo "   (     /   /  )%%%%%%%(  \\   \\     )\n";
echo "   (___/___/__/           \\__\\___\\___)\n";
echo "      (     /  /(%%%%%%%)\\  \\     )\n";
echo "       (__/___/ (%%%%%%%) \\___\\__)\n";
echo "               /(       )\\\n";
echo "             /   (%%%%%)   \\\n";
echo "                  (%%%)\n";

echo "\n\nWelcome to Bee v0.1\n\n";

if (!isset($argv[1])) {
    die("No file specified.\n");
}

$path = $argv[1];

if (!file_exists($path)) {
    die("Unable to load torrent file - file does not exist\n");
}

$Torrent = new Torrent\Handler($path);

if (!$Torrent->is_torrent()) {
    die("Unable to load torrent - is not torrent file\n");
}

echo "Loaded torrent:\n";
echo "	Filename: " . pathinfo($path, PATHINFO_BASENAME) . "\n";
echo "	Torrent name: " . $Torrent->name() . "\n";
echo "	Announce: " . $Torrent->announce() . "\n";
echo "	Infohash: " . strtoupper($Torrent->infohash()) . "\n";


// Initialize command handler

$Command = new Command\Handler;
$Command->announce_url = $Torrent->announce();
$Command->info_hash = $Torrent->infohash();
$Command->size = $Torrent->size();

$Command->loadTorrentAnnounce();

echo "> ";

while (false !== ($input = fgets(STDIN))) {

    echo "\n" . $Command->input($input) . "\n";

    echo "> ";
}